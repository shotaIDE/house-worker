# 凡例ロングタップによる単一項目表示機能の要件定義

## 概要

分析画面において、凡例をロングタップすることで、その項目のみが可視状態になる機能を実装する。これにより、ユーザーは特定の家事項目に焦点を当てて分析することができるようになる。

## 現状の実装

現在の分析画面では、以下の機能が実装されている：

1. 分析画面には「家事の頻度分析」「曜日ごとの頻度分析」「時間帯ごとの頻度分析」の 3 つのモードがある
2. 「曜日ごとの頻度分析」と「時間帯ごとの頻度分析」では、画面下部に凡例が表示されている
3. 凡例をタップすると、その項目の表示/非表示を切り替えることができる
4. 表示/非表示の状態は `HouseWorkVisibilities` クラスで管理されている
5. 凡例の表示状態に応じて、グラフの表示も更新される

## 要件

### 1. ロングタップ検出機能

- 凡例の各項目に対して、ロングタップイベントを検出する機能を追加する
- ロングタップの判定時間は標準的なものを採用する（一般的には 500ms 程度）

### 2. 単一項目表示機能

- 凡例の項目がロングタップされた場合、その項目のみを可視状態にし、他の全ての項目を非表示にする
- この状態変更は `HouseWorkVisibilities` クラスを通じて管理する
- 状態変更後、グラフの表示も即座に更新される

### 3. 状態遷移の定義

以下の状態遷移を定義する：

1. **通常状態**：初期状態。全ての項目が表示されているか、ユーザーが任意に表示/非表示を設定した状態
2. **単一表示状態**：ロングタップにより、特定の項目のみが表示されている状態

状態遷移の規則：

- 通常状態で項目をロングタップ → 単一表示状態に移行（ロングタップされた項目のみ表示）
- 単一表示状態で表示されている項目をタップ → 通常状態に戻る（全項目表示）
- 単一表示状態で非表示の項目をタップ → その項目も表示状態になる（通常状態に移行）
- 単一表示状態で別の項目をロングタップ → その項目のみの単一表示状態に切り替わる

### 4. ユーザーインターフェース

- ロングタップ機能の存在をユーザーに知らせるためのヒントを凡例の説明文に追加する
  - 現在の説明文: 「凡例: (タップで表示/非表示を切り替え)」
  - 新しい説明文: 「凡例: (タップで表示/非表示を切り替え、ロングタップでその項目のみ表示)」

### 5. パフォーマンスと応答性

- ロングタップ後の状態変更とグラフの更新は、ユーザーが遅延を感じないよう迅速に行われる必要がある
- グラフの更新処理は既存の仕組みを活用し、パフォーマンスへの影響を最小限に抑える

### 6. アクセシビリティ

- スクリーンリーダー対応のため、凡例項目には適切なセマンティックラベルを設定する
- ロングタップ機能の代替手段として、コンテキストメニューなどの検討も必要かもしれない

## 技術的な実装ポイント

1. **HouseWorkVisibilities クラスの拡張**

   - 単一項目表示のための新しいメソッドを追加する
   - 例: `showOnlyOne(String houseWorkId)` メソッドを追加し、指定された項目のみを表示状態にする

2. **\_Legends ウィジェットの拡張**

   - `GestureDetector` または `InkWell` の `onLongPress` コールバックを実装する
   - ロングタップ時に `HouseWorkVisibilities` の新メソッドを呼び出す

3. **状態管理の考慮事項**

   - 全ての項目が非表示になる状況を防ぐための安全策の実装

4. **UI/UX の改善**
   - ロングタップ機能の存在を示すヒントの表示
   - 単一表示状態であることを示す視覚的なインジケーター

## 影響範囲

この機能実装により、以下のファイルに変更が必要になると予想される：

1. `client/lib/features/analysis/analysis_presenter.dart`

   - `HouseWorkVisibilities` クラスに新しいメソッドを追加

2. `client/lib/features/analysis/analysis_screen.dart`
   - `_Legends` クラスにロングタップ処理を追加
   - 凡例の説明文を更新

## テスト項目

1. **機能テスト**

   - 凡例項目のロングタップで正しく単一表示状態になるか
   - 単一表示状態で表示項目をタップすると全項目表示に戻るか
   - 単一表示状態で非表示項目をタップすると、その項目も表示されるか
   - 単一表示状態で別の項目をロングタップすると、表示項目が切り替わるか

2. **UI/UX テスト**

   - ロングタップのフィードバックは適切か
   - 状態変更時のアニメーションは自然か
   - 説明文は分かりやすいか

3. **パフォーマンステスト**
   - 状態変更とグラフ更新のレスポンスは十分に速いか

## 将来の拡張性

1. **複数モード対応**

   - 現在は「曜日ごとの頻度分析」と「時間帯ごとの頻度分析」に凡例があるが、将来的に他の分析モードが追加された場合にも対応できる設計にする

2. **設定の永続化**

   - ユーザーが設定した表示/非表示状態を保存し、アプリ再起動後も維持する機能の検討

3. **複数項目の選択**
   - 将来的に、複数の特定項目だけを表示する機能の追加も検討
