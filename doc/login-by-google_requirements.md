# Google アカウントでログイン機能の要件定義

## 1. 概要

- ユーザーが Google アカウントを使用してアプリケーションにログインできる機能を追加する
- 現在実装されている匿名認証に加えて、Google アカウントでの認証オプションを提供する
- ログイン後のユーザー体験を向上させ、ユーザー情報の永続性を確保する

## 2. 機能要件

### 2.1 認証フロー

- ログイン画面に Google でログインするボタンを追加する
- ボタン押下時に Google の認証画面を表示する
- 認証成功後、Firebase の認証情報を取得する
- 取得した情報を基にユーザー情報を Firestore に保存する
- ログイン成功後、アプリのホーム画面に遷移する

### 2.2 ユーザー情報の管理

- Google アカウントから取得した情報（名前、メールアドレス、プロフィール画像 URL）をユーザーモデルに反映する
- 既存ユーザーの場合は情報を更新し、新規ユーザーの場合は新たにユーザーレコードを作成する
- 匿名ユーザーから Google アカウントへの連携（アカウントのアップグレード）をサポートする

### 2.3 セッション管理

- ログイン状態を保持し、アプリ再起動時に自動的にログインする
- ログアウト機能を提供する
- トークンの有効期限が切れた場合の再認証処理を実装する

### 2.4 エラーハンドリング

- 認証失敗時のエラーメッセージを適切に表示する
- ネットワーク接続がない場合のエラー処理を実装する
- ユーザーが Google アカウント連携をキャンセルした場合の処理を実装する

## 3. 非機能要件

### 3.1 セキュリティ

- OAuth 2.0 プロトコルに準拠した安全な認証を実装する
- 認証情報の安全な保存と管理を行う
- 適切なスコープのみを要求し、必要最小限の権限で Google アカウントにアクセスする

### 3.2 パフォーマンス

- 認証処理は 3 秒以内に完了することを目標とする
- バックグラウンドでの認証情報の更新を効率的に行う

### 3.3 ユーザビリティ

- 認証中はローディングインジケータを表示し、ユーザーに進行状況を伝える
- 直感的でわかりやすい UI/UX を提供する
- 異なるデバイスサイズでも適切に表示される responsive なデザインにする

## 4. 技術要件

### 4.1 使用技術

- Firebase Authentication を使用して Google アカウント認証を実装する
- google_sign_in パッケージを使用して Google の認証フローを処理する
- Riverpod を使用して認証状態を管理する
- Firestore を使用してユーザー情報を保存する

### 4.2 プラットフォーム対応

- iOS と Android の両方のプラットフォームで Google ログインを実装する
- 各プラットフォーム固有の設定（Android の Google Services JSON や iOS の GoogleService-Info.plist）を適切に構成する

## 5. 影響範囲

### 5.1 既存コードへの影響

- `AuthService` クラスに Google 認証メソッドを追加する
- `login_screen.dart` に Google ログインボタンを追加する
- `login_presenter.dart` に Google ログイン処理を追加する
- `User` モデルに Google アカウント情報を保存するフィールドを追加する（必要に応じて）

### 5.2 データベースへの影響

- ユーザーコレクションのスキーマに変更が必要な場合は対応する
- 既存の匿名ユーザーデータの移行方法を検討する

## 6. テスト要件

- 新規ユーザーの Google アカウントでのログインテスト
- 既存ユーザーの Google アカウントでのログインテスト
- 匿名ユーザーから Google アカウントへの連携テスト
- エラーケースのテスト（認証失敗、ネットワークエラーなど）
- 異なるデバイスでの UI テスト

## 7. 制約事項

- Google Developer Console でのプロジェクト設定が必要
- Firebase プロジェクトでの Google 認証の有効化が必要
- 各プラットフォーム（iOS/Android）での適切な設定が必要
